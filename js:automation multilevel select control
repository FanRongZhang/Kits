
<script src='//code.jquery.com/ui/1.11.1/jquery-ui.js'></script>

<script>
    /*
    domId require param  : select's wrap container's id
    setValue optional param: the final value of select should show
    */
    var AutoMultilevelSelects = function(domId,setValue){
        //pid means the parent select's v's value,i think i should change the name pid to pv
        //v means the value of the select and t means the text of the select
        this._data = [{pid:0,v:'0',t:'A1'},{pid:0,v:'1',t:'A2'},{pid:'0',v:'3',t:'B1'}];

        this._wrap = $("#"+domId);

        //restore the selected value and it's all parent value
        this._default_values = [];
        if(setValue){
            //restore the selected value
            this._default_values.push(setValue);

            //step 1:find out which item it is in the dataï¼ˆthis._data)
            //and figure out the all parent in step 2 by the item's pid
            var _set_item;
            for(var i=0;i<this._data.length;i++){
                if(this._data[i].v==setValue){
                    _set_item = this._data[i];
                    break;
                }
            }

            //step 2:find out the item's all parent item,and restore the corresponding item's value
            var _parent_item;
            for(var i=0;i<this._data.length;i++){
                if(_parent_item){
                    if(_parent_item.pid == this._data[i].v){
                        _parent_item = this._data[i];
                        this._default_values.push(_parent_item.v);
                    }
                }else{
                    if(this._data[i].v==_set_item.pid){
                        _parent_item = this._data[i];
                        this._default_values.push(_parent_item.v);
                    }
                }
            }
        }

        //create select and handler the change event(delete old selects and create new selects)
        //@@prame the event select--dom object
        this.createSelect = function(changeselect){
            //init
            if(!changeselect){
                var _select_html = "<select class='select' onchange='new AutoMultilevelSelects(\""+domId+"\",null).createSelect(this)' >";
                for(var i=0;i<this._data.length;i++){
                    switch(this._data[i].v.length){
                        case 2:
                            var _b=false;
                            if(setValue){
                                _b = this._data[i].v==setValue.substring(0,2);
                            }
                            _select_html += "<option value=\""+this._data[i].v+"\" "+(_b?"selected='selected'":"")+">"+this._data[i].t+"</option>";
                            break;
                    }
                }
                _select_html += "</select>";
                this._wrap.append(_select_html);
            }

            //if it's a change event,remove the all selects after itself
            if(changeselect){
                if($(changeselect).nextAll().size()>0){
                    $(changeselect).nextAll().remove();
                }
            }

            //create the child select
            while(true){
                var _done = true;
                var _current_val = $("#"+domId +" .select:last").val();
                var _one_select = "<select class='select' onchange='new AutoMultilevelSelects(\""+domId+"\",null).createSelect(this)' >";
                for(var i=0;i<this._data.length;i++){
                    if(this._data[i].pid==_current_val){
                        _done = false;
                        var _b=false;
                        if(setValue){
                            for(var index in this._default_values){
                                if(this._default_values[index]==this._data[i].v){
                                    _b=true;
                                    break;
                                }
                            }
                        }
                        _one_select += "<option value=\""+this._data[i].v+"\" "+(_b?"selected='selected'":"")+">"+this._data[i].t+"</option>";
                    }
                }
                _one_select += "</select>";
                if(_done)
                    break;
                else{
                    this._wrap.append(_one_select);
                }
            }
            
        }
    }
</script>
<div id='a'></div>
<div id='b'></div>
<button onclick='AutoMultilevelSelects("b",'3')'>create one multilevels selects of choosed value is '3'</button>
<script>AutoMultilevelSelects("a",'');</script>
